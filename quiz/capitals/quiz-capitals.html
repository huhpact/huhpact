<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capitals Quiz</title>
    <link rel="stylesheet" href="/quiz/style.css">
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <style>
        .question-card {
            background: var(--bg-card);
            border: 1.5px solid var(--border);
            border-radius: var(--radius-xl);
            padding: 2rem 2rem 1.75rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .question-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 80% 20%, rgba(232,100,58,0.04) 0%, transparent 60%);
            pointer-events: none;
        }

        .question-label {
            font-size: 0.72rem;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 1rem;
            display: block;
        }

        .question-text {
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--text);
            line-height: 1.3;
            margin: 0;
        }

        .question-sub {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 0.4rem;
        }

        /* ── Answer grid ── */
        .answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .answer-btn {
            background: var(--bg-card);
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            padding: 1rem 1.1rem;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            text-align: left;
            font-family: inherit;
            transition: border-color 0.15s, background 0.15s, transform 0.1s;
            line-height: 1.3;
            position: relative;
            overflow: hidden;
        }

        .answer-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--accent);
            opacity: 0;
            transition: opacity 0.15s;
        }

        .answer-btn:hover:not(:disabled) {
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .answer-btn:hover:not(:disabled)::before {
            opacity: 0.06;
        }

        .answer-btn:active:not(:disabled) {
            transform: scale(0.98);
        }

        .answer-btn.correct {
            border-color: #22c55e;
            background: rgba(34,197,94,0.12);
            color: #22c55e;
        }

        .answer-btn.incorrect {
            border-color: #ef4444;
            background: rgba(239,68,68,0.10);
            color: #ef4444;
        }

        .answer-btn.reveal {
            border-color: #22c55e;
            background: rgba(34,197,94,0.07);
            color: #22c55e;
        }

        .answer-btn:disabled {
            cursor: default;
            transform: none;
        }

        .answer-letter {
            display: inline-block;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--border);
            color: var(--text-muted);
            font-size: 0.72rem;
            font-weight: 800;
            text-align: center;
            line-height: 22px;
            margin-right: 0.5rem;
            flex-shrink: 0;
            transition: background 0.15s, color 0.15s;
        }

        .answer-btn.correct .answer-letter  { background: #22c55e; color: #fff; }
        .answer-btn.incorrect .answer-letter { background: #ef4444; color: #fff; }
        .answer-btn.reveal .answer-letter    { background: #22c55e; color: #fff; }

        /* ── Feedback ── */
        .feedback-bar {
            min-height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.88rem;
            font-weight: 600;
            margin-top: 1rem;
            border-radius: var(--radius-sm);
            padding: 0.4rem 1rem;
            transition: opacity 0.2s;
        }

        .feedback-bar.correct  { color: #22c55e; background: rgba(34,197,94,0.08); }
        .feedback-bar.incorrect { color: #ef4444; background: rgba(239,68,68,0.08); }
        .feedback-bar.hidden   { opacity: 0; }

        /* ── Next button ── */
        .next-btn {
            width: 100%;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: var(--radius-md);
            padding: 0.9rem;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            margin-top: 0.75rem;
            transition: opacity 0.15s, transform 0.1s;
            display: none;
        }

        .next-btn.visible { display: block; }
        .next-btn:hover   { opacity: 0.88; }
        .next-btn:active  { transform: scale(0.98); }

        /* ── Progress bar ── */
        .progress-bar-wrap {
            height: 3px;
            background: var(--border);
            border-radius: 99px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 99px;
            transition: width 0.4s ease;
        }

        /* ── Category badge ── */
        .category-tag {
            font-size: 0.68rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-muted);
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 99px;
            padding: 2px 10px;
            margin-left: 0.5rem;
            vertical-align: middle;
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.94) translateY(6px); }
            to   { opacity: 1; transform: scale(1) translateY(0); }
        }

        .answers-grid { animation: popIn 0.3s cubic-bezier(0.34,1.4,0.64,1) both; }
    </style>
</head>
<body>
    <div class="container">
        <div class="quiz-top-bar">
            <div class="score-display">
                <span class="score-label">Score:</span>
                <span class="score-value" id="score">0</span>
            </div>
            <div class="progress-display">
                <span id="current-question">1</span> / <span id="total-questions">10</span>
            </div>
        </div>

        <div class="progress-bar-wrap">
            <div class="progress-bar-fill" id="progress-bar" style="width:0%"></div>
        </div>

        <main class="quiz-container">
            <div class="question-card">
                <span class="question-label">What is the capital of…</span>
                <p class="question-text" id="question-country">—</p>
                <p class="question-sub" id="question-region"></p>
            </div>

            <div class="answers-grid" id="answers-grid">
                <!-- buttons injected by JS -->
            </div>

            <div class="feedback-bar hidden" id="feedback-bar"></div>

            <button class="next-btn" id="next-btn">Next →</button>
        </main>
    </div>

    <!-- Results modal -->
    <div id="results-modal" class="modal hidden">
        <div class="modal-content">
            <h2 class="neon-text">Quiz Complete!</h2>
            <div class="results-stats">
                <div class="stat-item">
                    <span class="stat-value" id="final-score">0</span>
                    <span class="stat-label">Correct</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="final-total">10</span>
                    <span class="stat-label">Total</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="final-percentage">0%</span>
                    <span class="stat-label">Accuracy</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="window.location.href='quiz-capitals-setup.html'">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                    Try Again
                </button>
                <button class="modal-btn secondary" onclick="window.location.href='/quiz/index.html'">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    Back to Home
                </button>
            </div>
        </div>
    </div>

    <script src="capitals.js"></script>
    <script>
        var questions     = [];
        var current       = 0;
        var score         = 0;
        var answered      = false;
        var advanceTimer  = null;

        var REGION_LABELS = {
            europe:   'Europe',
            asia:     'Asia',
            africa:   'Africa',
            americas: 'Americas',
            oceania:  'Oceania'
        };

        var LETTERS = ['A', 'B', 'C', 'D'];

        /* ── Init ── */
        document.addEventListener('DOMContentLoaded', function () {
            var total    = parseInt(sessionStorage.getItem('capitalsQuizQuestions')) || 10;
            var category = sessionStorage.getItem('capitalsQuizCategory') || 'all';

            var pool = category === 'all'
                ? quizCapitals.slice()
                : quizCapitals.filter(function (c) { return c.category === category; });

            // shuffle
            for (var i = pool.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var t = pool[i]; pool[i] = pool[j]; pool[j] = t;
            }

            questions = pool.slice(0, Math.min(total, pool.length));
            document.getElementById('total-questions').textContent = questions.length;

            // Next button click
            document.getElementById('next-btn').addEventListener('click', function () {
                advance();
            });

            // Keyboard 1-4 for answer selection
            document.addEventListener('keydown', function (e) {
                if (answered) {
                    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); advance(); }
                    return;
                }
                var idx = parseInt(e.key) - 1;
                if (idx >= 0 && idx <= 3) {
                    var btns = document.querySelectorAll('.answer-btn');
                    if (btns[idx]) selectAnswer(idx);
                }
            });

            loadQuestion();
        });

        /* ── Load question ── */
        function loadQuestion() {
            if (current >= questions.length) { showResults(); return; }

            answered = false;
            if (advanceTimer !== null) { clearTimeout(advanceTimer); advanceTimer = null; }

            var q = questions[current];

            // Progress
            var pct = Math.round((current / questions.length) * 100);
            document.getElementById('progress-bar').style.width = pct + '%';
            document.getElementById('current-question').textContent = current + 1;

            // Question text
            document.getElementById('question-country').textContent = q.country;
            document.getElementById('question-region').textContent  = REGION_LABELS[q.category] || '';

            // Build 4 options: correct + 3 random wrong from same/all pool
            var options = buildOptions(q);

            // Render answer buttons
            var grid = document.getElementById('answers-grid');
            grid.innerHTML = '';
            // Re-trigger animation
            grid.style.animation = 'none';
            grid.offsetHeight; // reflow
            grid.style.animation = '';

            options.forEach(function (opt, i) {
                var btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.dataset.index = i;
                btn.innerHTML = '<span class="answer-letter">' + LETTERS[i] + '</span>' + opt;
                btn.addEventListener('click', function () { selectAnswer(i); });
                grid.appendChild(btn);
            });

            // Hide feedback & next
            var fb = document.getElementById('feedback-bar');
            fb.textContent = '';
            fb.className   = 'feedback-bar hidden';
            document.getElementById('next-btn').className = 'next-btn';
        }

        /* ── Build 4 options ── */
        function buildOptions(q) {
            // Get wrong answers from the full pool
            var others = quizCapitals
                .filter(function (c) { return c.capital !== q.capital; })
                .map(function (c) { return c.capital; });

            // shuffle others
            for (var i = others.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var t = others[i]; others[i] = others[j]; others[j] = t;
            }

            var choices = [q.capital, others[0], others[1], others[2]];

            // shuffle choices
            for (var i = choices.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var t = choices[i]; choices[i] = choices[j]; choices[j] = t;
            }

            return choices;
        }

        /* ── Select answer ── */
        function selectAnswer(idx) {
            if (answered) return;
            answered = true;

            var q       = questions[current];
            var btns    = document.querySelectorAll('.answer-btn');
            var chosen  = btns[idx].innerHTML.replace(/<span[^>]*>[^<]*<\/span>/, '').trim();
            var isRight = chosen === q.capital;

            // Disable all buttons
            btns.forEach(function (b) { b.disabled = true; });

            // Mark correct and chosen
            btns.forEach(function (b) {
                var txt = b.innerHTML.replace(/<span[^>]*>[^<]*<\/span>/, '').trim();
                if (txt === q.capital) {
                    b.classList.add(isRight ? 'correct' : 'reveal');
                }
            });
            if (!isRight) {
                btns[idx].classList.add('incorrect');
            }

            // Feedback
            var fb = document.getElementById('feedback-bar');
            if (isRight) {
                score++;
                document.getElementById('score').textContent = score;
                fb.textContent = '✓ Correct!';
                fb.className   = 'feedback-bar correct';
            } else {
                fb.textContent = '✗ Wrong — the capital is ' + q.capital;
                fb.className   = 'feedback-bar incorrect';
            }

            // Show next button
            document.getElementById('next-btn').className = 'next-btn visible';
            document.getElementById('next-btn').textContent = 'Next →';

            // Auto-advance
            advanceTimer = setTimeout(function () { advance(); }, isRight ? 1600 : 2600);
        }

        /* ── Advance ── */
        function advance() {
            if (advanceTimer !== null) { clearTimeout(advanceTimer); advanceTimer = null; }
            current++;
            loadQuestion();
        }

        /* ── Results ── */
        function showResults() {
            document.getElementById('progress-bar').style.width = '100%';
            var pct = Math.round((score / questions.length) * 100);
            document.getElementById('final-score').textContent      = score;
            document.getElementById('final-total').textContent      = questions.length;
            document.getElementById('final-percentage').textContent = pct + '%';
            document.getElementById('results-modal').classList.remove('hidden');
        }
    </script>
</body>
</html>