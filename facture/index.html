<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Factures Professionnel</title>
    <link rel="stylesheet" href="/facture/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-file-invoice"></i> Générateur de Factures</h1>
                <div class="header-controls">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn-secondary" id="loadDraft">
                        <i class="fas fa-folder-open"></i> Charger un brouillon
                    </button>
                    <button class="btn-secondary" id="saveDraft">
                        <i class="fas fa-save"></i> Sauvegarder
                    </button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Form Section -->
            <div class="form-section">
                <form id="invoiceForm">
                    <!-- Language & Basic Settings -->
                    <div class="card">
                        <h2><i class="fas fa-cog"></i> Paramètres généraux</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="invoiceLanguage">Langue de la facture</label>
                                <select id="invoiceLanguage" required>
                                    <option value="fr">Français</option>
                                    <option value="de">Deutsch</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="currency">Devise</label>
                                <select id="currency" required>
                                    <option value="EUR">EUR (€)</option>
                                    <option value="USD">USD ($)</option>
                                    <option value="GBP">GBP (£)</option>
                                    <option value="CHF">CHF</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="brandColor">Couleur principale</label>
                                <input type="color" id="brandColor" value="#3B82F6">
                            </div>
                        </div>
                    </div>

                    <!-- Invoice Details -->
                    <div class="card">
                        <h2><i class="fas fa-info-circle"></i> Détails de la facture</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="invoiceNumber">Numéro de facture</label>
                                <div class="input-group">
                                    <input type="text" id="invoiceNumber" required>
                                    <button type="button" id="generateInvoiceNumber" class="btn-icon">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="creationDate">Date de création</label>
                                <input type="date" id="creationDate" required>
                            </div>
                            <div class="form-group">
                                <label for="dueDate">Date d'échéance</label>
                                <input type="date" id="dueDate" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="serviceDate">Date/Période de service</label>
                                <input type="text" id="serviceDate" placeholder="ex: Mars 2025">
                            </div>
                            <div class="form-group">
                                <label for="reference">Référence/Objet</label>
                                <input type="text" id="reference" placeholder="Objet de la facture">
                            </div>
                        </div>
                    </div>

                    <!-- Company Logo -->
                    <div class="card">
                        <h2><i class="fas fa-image"></i> Logo de l'entreprise</h2>
                        <div class="logo-upload" id="logoUpload">
                            <div class="logo-preview" id="logoPreview">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Glissez votre logo ici ou cliquez pour sélectionner</p>
                                <small>PNG, JPG - Max 2MB</small>
                            </div>
                            <input type="file" id="logoInput" accept="image/png,image/jpeg" hidden>
                            <button type="button" id="removeLogo" class="btn-danger" style="display: none;">
                                <i class="fas fa-trash"></i> Supprimer le logo
                            </button>
                        </div>
                    </div>

                    <!-- Seller Information -->
                    <div class="card">
                        <h2><i class="fas fa-building"></i> Informations du vendeur</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sellerCompany">Nom de l'entreprise *</label>
                                <input type="text" id="sellerCompany" required>
                            </div>
                            <div class="form-group">
                                <label for="sellerContact">Nom du contact *</label>
                                <input type="text" id="sellerContact" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="sellerAddress">Adresse *</label>
                            <textarea id="sellerAddress" rows="3" required></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sellerEmail">Email *</label>
                                <input type="email" id="sellerEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="sellerPhone">Téléphone *</label>
                                <input type="tel" id="sellerPhone" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sellerVat">Numéro de TVA</label>
                                <input type="text" id="sellerVat" placeholder="Optionnel">
                            </div>
                            <div class="form-group">
                                <label for="sellerReg">Numéro d'entreprise</label>
                                <input type="text" id="sellerReg" placeholder="Optionnel">
                            </div>
                        </div>
                    </div>

                    <!-- Buyer Information -->
                    <div class="card">
                        <h2><i class="fas fa-user"></i> Informations de l'acheteur</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="buyerCompany">Nom de l'entreprise</label>
                                <input type="text" id="buyerCompany">
                            </div>
                            <div class="form-group">
                                <label for="buyerContact">Nom du contact</label>
                                <input type="text" id="buyerContact">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="buyerAddress">Adresse</label>
                            <textarea id="buyerAddress" rows="3"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="buyerEmail">Email</label>
                                <input type="email" id="buyerEmail">
                            </div>
                            <div class="form-group">
                                <label for="buyerTax">Numéro fiscal</label>
                                <input type="text" id="buyerTax">
                            </div>
                        </div>
                    </div>

                    <!-- Invoice Items -->
                    <div class="card">
                        <h2><i class="fas fa-list"></i> Articles/Services</h2>
                        <div class="items-table">
                            <div class="table-header">
                                <div class="col-description">Description</div>
                                <div class="col-price">Prix unitaire</div>
                                <div class="col-quantity">Quantité</div>
                                <div class="col-discount">Remise</div>
                                <div class="col-total">Total ligne</div>
                                <div class="col-actions">Actions</div>
                            </div>
                            <div id="itemsContainer">
                                <!-- Items will be added dynamically -->
                            </div>
                            <button type="button" id="addItem" class="btn-secondary">
                                <i class="fas fa-plus"></i> Ajouter un article
                            </button>
                        </div>
                    </div>

                    <!-- Tax Settings -->
                    <div class="card">
                        <h2><i class="fas fa-percentage"></i> Paramètres de TVA</h2>
                        <div class="form-row">
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="applyVat">
                                <label for="applyVat">Appliquer la TVA</label>
                            </div>
                            <div class="form-group">
                                <label for="vatRate">Taux de TVA (%)</label>
                                <input type="number" id="vatRate" value="19" min="0" max="100" step="0.01">
                            </div>
                        </div>
                        <div class="vat-exemption-notice" id="vatExemptionNotice">
                            <i class="fas fa-info-circle"></i>
                            <span>Le texte d'exonération de TVA sera automatiquement ajouté selon la langue choisie.</span>
                        </div>
                    </div>

                    <!-- Payment Information -->
                    <div class="card">
                        <h2><i class="fas fa-credit-card"></i> Informations de paiement</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="paymentIban">IBAN</label>
                                <input type="text" id="paymentIban">
                            </div>
                            <div class="form-group">
                                <label for="paymentBic">BIC/SWIFT</label>
                                <input type="text" id="paymentBic">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="paymentPaypal">Lien PayPal</label>
                            <input type="url" id="paymentPaypal" placeholder="https://paypal.me/...">
                        </div>
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="includeQr">
                            <label for="includeQr">Inclure un QR code pour le virement bancaire</label>
                        </div>
                    </div>

                    <!-- Notes and Terms -->
                    <div class="card">
                        <h2><i class="fas fa-sticky-note"></i> Notes et conditions</h2>
                        <div class="form-group">
                            <label for="notes">Notes et remarques</label>
                            <textarea id="notes" rows="4" placeholder="Notes additionnelles..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="terms">Conditions de paiement</label>
                            <textarea id="terms" rows="4" placeholder="Conditions générales..."></textarea>
                        </div>
                    </div>

                    <!-- Totals Summary -->
                    <div class="card totals-card">
                        <h2><i class="fas fa-calculator"></i> Récapitulatif</h2>
                        <div class="totals-display">
                            <div class="total-line">
                                <span>Sous-total:</span>
                                <span id="subtotalDisplay">0,00 €</span>
                            </div>
                            <div class="total-line">
                                <span>TVA:</span>
                                <span id="vatDisplay">0,00 €</span>
                            </div>
                            <div class="total-line total-final">
                                <span>Total TTC:</span>
                                <span id="totalDisplay">0,00 €</span>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="actions">
                        <button type="button" id="previewBtn" class="btn-secondary">
                            <i class="fas fa-eye"></i> Aperçu
                        </button>
                        <button type="button" id="generatePdfBtn" class="btn-primary">
                            <i class="fas fa-file-pdf"></i> Générer la facture PDF
                        </button>
                    </div>
                </form>
            </div>

            <!-- Preview Section -->
            <div class="preview-section" id="previewSection">
                <div class="preview-header">
                    <h3><i class="fas fa-eye"></i> Aperçu de la facture</h3>
                    <button id="closePreview" class="btn-icon">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="preview-content" id="previewContent">
                    <!-- Preview will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for saved drafts -->
    <div class="modal" id="draftsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Brouillons sauvegardés</h3>
                <button class="btn-icon" id="closeDraftsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="draftsModalBody">
                <!-- Drafts will be listed here -->
            </div>
        </div>
    </div>

    <!-- Loading indicator -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <p>Génération du PDF en cours...</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="/facture/translations.js"></script>
    <script src="/facture/pdf-generator.js"></script>
    <script src="/facture/script.js"></script>
</body>
</html>