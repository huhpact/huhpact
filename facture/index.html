<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <link rel="manifest" href="/facture/manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>huh(pact) Factures</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/facture/styles.css">
    <link rel="stylesheet" href="/facture/pw.css">
  </head>
  <body>
<div class="site-wrap" id="siteWrap"></div>
  <div class="pw-overlay" id="pwOverlay">
<div class="pw-card" role="dialog" aria-modal="true" aria-labelledby="pwTitle">
<h2 id="pwTitle">üõ°Ô∏è Acc√®s s√©curis√©</h2>
<p>Veuillez entrer le mot de passe pour continuer</p>
<input id="pwInput" class="pw-input" type="password" placeholder="Mot de passe" autocomplete="off">
<div class="pw-row">
<button class="btn btn-primary" id="pwSubmit">Entrer</button>
</div>
<div class="hint">
<label><input type="checkbox" id="rememberCb"> M√©moriser l'acc√®s</label>
</div>
<div id="message" aria-live="polite"></div>
</div>
</div>
    <div id="app">
      <header class="app-header">
        <div class="header-content">
          <h1 class="app-title" data-i18n="app.title">Invoice Editor</h1>
          <div class="header-actions">
            <select id="languageSelect" class="language-select" aria-label="Language">
              <option value="en">English</option>
              <option value="de">Deutsch</option>
              <option value="fr">Fran√ßais</option>
            </select>
            <button id="helpBtn" class="btn btn-secondary" data-i18n="app.help">Help</button>
            <button id="saveBtn" class="btn btn-primary" data-i18n="app.save">Save</button>
            <button id="exportBtn" class="btn btn-primary" data-i18n="app.export">Export</button>
          </div>
        </div>
      </header>

      <div class="toolbar">
        <div class="toolbar-group">
          <button id="newBtn" class="btn btn-secondary" data-i18n="app.new">New Invoice</button>
          <button id="loadBtn" class="btn btn-secondary" data-i18n="app.load">Load</button>
          <button id="importBtn" class="btn btn-secondary" data-i18n="actions.importJson">Import JSON</button>
        </div>
        <div class="toolbar-group">
          <button id="generatePdfBtn" class="btn btn-success" data-i18n="app.generatePdf">Generate PDF</button>
          <button id="printBtn" class="btn btn-success" data-i18n="app.print">Print</button>
        </div>
      </div>

      <main class="main-content">
        <aside class="editor-panel">
          <div class="panel-header">
            <h2 data-i18n="invoice.title">Invoice</h2>
          </div>

          <div class="editor-section">
            <h3 data-i18n="invoice.seller">From</h3>
            <div class="form-row">
              <label>
                <span data-i18n="fields.companyName">Company Name</span>
                <input type="text" id="sellerCompany" class="form-input" />
              </label>
            </div>
            <div class="form-row">
              <label>
                <span data-i18n="fields.contactName">Contact Name</span>
                <input type="text" id="sellerContact" class="form-input" />
              </label>
            </div>
            <div class="form-row">
              <label>
                <span data-i18n="fields.street">Street</span>
                <input type="text" id="sellerStreet" class="form-input" />
              </label>
            </div>
            <div class="form-row form-row-2">
              <label>
                <span data-i18n="fields.postalCode">Postal Code</span>
                <input type="text" id="sellerPostalCode" class="form-input" />
              </label>
              <label>
                <span data-i18n="fields.city">City</span>
                <input type="text" id="sellerCity" class="form-input" />
              </label>
            </div>
            <div class="form-row">
              <label>
                <span data-i18n="fields.country">Country</span>
                <input type="text" id="sellerCountry" class="form-input" />
              </label>
            </div>
            <div class="form-row form-row-2">
              <label>
                <span data-i18n="fields.email">Email</span>
                <input type="email" id="sellerEmail" class="form-input" />
              </label>
              <label>
                <span data-i18n="fields.phone">Phone</span>
                <input type="tel" id="sellerPhone" class="form-input" />
              </label>
            </div>
            <div class="form-row form-row-2">
              <label>
                <span data-i18n="fields.taxNumber">Tax Number</span>
                <input type="text" id="sellerTaxNumber" class="form-input" />
              </label>
              <label>
                <span data-i18n="fields.vatId">VAT ID</span>
                <input type="text" id="sellerVatId" class="form-input" />
              </label>
            </div>
            <div class="form-row">
              <label>
                <span data-i18n="fields.uploadLogo">Upload Logo</span>
                <input type="file" id="logoUpload" accept="image/*" class="form-input" />
              </label>
            </div>
            <div class="form-row">
              <label>
                <span data-i18n="fields.logoPosition">Logo Position</span>
                <select id="logoPosition" class="form-input">
                  <option value="left" data-i18n="position.left">Left</option>
                  <option value="center" data-i18n="position.center">Center</option>
                  <option value="right" data-i18n="position.right">Right</option>
                </select>
              </label>
            </div>
          </div>

          <div class="editor-section">
            <h3 data-i18n="invoice.buyer">Bill To</h3>
            <div class="form-row">
              <label>
                <span data-i18n="fields.companyName">Company Name</span>
                <input type="text" id="buyerCompany" class="form-input" />
              </label>
            </div>
            <div class="form-row">
              <label>
                <span data-i18n="fields.contactName">Contact Name</span>
                <input type="text" id="buyerContact" class="form-input" />
              </label>
            </div>
            <div class="form-row">
              <label>
                <span data-i18n="fields.street">Street</span>
                <input type="text" id="buyerStreet" class="form-input" />
              </label>
            </div>
            <div class="form-row form-row-2">
              <label>
                <span data-i18n="fields.postalCode">Postal Code</span>
                <input type="text" id="buyerPostalCode" class="form-input" />
              </label>
              <label>
                <span data-i18n="fields.city">City</span>
                <input type="text" id="buyerCity" class="form-input" />
              </label>
            </div>
            <div class="form-row">
              <label>
                <span data-i18n="fields.country">Country</span>
                <input type="text" id="buyerCountry" class="form-input" />
              </label>
            </div>
            <div class="form-row form-row-2">
              <label>
                <span data-i18n="fields.email">Email</span>
                <input type="email" id="buyerEmail" class="form-input" />
              </label>
              <label>
                <span data-i18n="fields.phone">Phone</span>
                <input type="tel" id="buyerPhone" class="form-input" />
              </label>
            </div>
            <div class="form-row form-row-2">
              <label>
                <span data-i18n="fields.taxNumber">Tax Number</span>
                <input type="text" id="buyerTaxNumber" class="form-input" />
              </label>
              <label>
                <span data-i18n="fields.vatId">VAT ID</span>
                <input type="text" id="buyerVatId" class="form-input" />
              </label>
            </div>
          </div>

          <div class="editor-section">
            <h3 data-i18n="invoice.title">Invoice Details</h3>
            <div class="form-row form-row-2">
              <label>
                <span data-i18n="invoice.number">Invoice No.</span>
                <input type="text" id="invoiceNumber" class="form-input" />
              </label>
              <label>
                <span data-i18n="invoice.date">Date</span>
                <input type="date" id="invoiceDate" class="form-input" />
              </label>
            </div>
            <div class="form-row form-row-2">
              <label>
                <span data-i18n="invoice.dueDate">Due Date</span>
                <input type="date" id="invoiceDueDate" class="form-input" />
              </label>
              <label>
                <span data-i18n="invoice.deliveryDate">Delivery Date</span>
                <input type="date" id="invoiceDeliveryDate" class="form-input" />
              </label>
            </div>
            <div class="form-row">
              <label class="checkbox-label">
                <input type="checkbox" id="kleinunternehmer" />
                <span data-i18n="german.kleinunternehmer">Small Business (¬ß19 UStG)</span>
              </label>
            </div>
          </div>

          <div class="editor-section">
            <div class="section-header">
              <h3>Line Items</h3>
              <button id="addItemBtn" class="btn btn-small btn-primary" data-i18n="actions.addItem">Add Item</button>
            </div>
            <div id="lineItemsContainer" class="line-items-container">
            </div>
          </div>

          <div class="editor-section">
            <h3 data-i18n="invoice.notes">Notes</h3>
            <textarea id="notes" class="form-textarea" rows="3"></textarea>
          </div>

          <div class="editor-section">
            <h3 data-i18n="invoice.paymentTerms">Payment Terms</h3>
            <textarea id="paymentTerms" class="form-textarea" rows="2"></textarea>
          </div>
        </aside>

        <div class="preview-panel">
          <div class="preview-header">
            <h2>Preview</h2>
          </div>
          <div id="invoicePreview" class="invoice-preview">
          </div>
        </div>
      </main>
    </div>

    <div id="helpModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2 data-i18n="help.title">Help & Compliance</h2>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <section class="help-section">
            <h3 data-i18n="help.germanLegal">German Legal Requirements</h3>
            <p data-i18n="help.germanLegalText">When creating German invoices, ensure all required fields per ¬ß14 UStG are filled.</p>
          </section>
          <section class="help-section">
            <h3 data-i18n="help.kleinunternehmerHelp">Kleinunternehmer Help</h3>
            <p data-i18n="help.kleinunternehmerHelp">If you qualify as a 'Kleinunternehmer' (small business) under ¬ß19 UStG, enable this option.</p>
          </section>
          <section class="help-section">
            <h3 data-i18n="help.archivingHelp">Archiving Help</h3>
            <p data-i18n="help.archivingHelp">The GoBD requires proper archiving of electronic invoices.</p>
          </section>
          <section class="help-section">
            <h3 data-i18n="help.references">Official References</h3>
            <ul class="reference-list">
              <li><a href="https://www.gesetze-im-internet.de/ustg_1980/__14.html" target="_blank" rel="noopener">¬ß14 UStG - Invoice Requirements</a></li>
              <li><a href="https://www.gesetze-im-internet.de/ustg_1980/__19.html" target="_blank" rel="noopener">¬ß19 UStG - Small Business Rules</a></li>
              <li><a href="https://www.bundesfinanzministerium.de/Content/DE/Downloads/BMF_Schreiben/Weitere_Steuerthemen/Abgabenordnung/2019-11-28-GoBD.html" target="_blank" rel="noopener">BMF GoBD - E-Invoice & Archiving</a></li>
            </ul>
          </section>
          <section class="help-section disclaimer">
            <h3 data-i18n="german.legalDisclaimer">Legal Disclaimer</h3>
            <p data-i18n="german.disclaimerText">This tool helps create legally-structured invoices, but it does not replace tax advice.</p>
          </section>
        </div>
      </div>
    </div>

    <input type="file" id="importFileInput" accept=".json" style="display: none;" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="/facture/js/i18n.js"></script>
    <script src="/facture/js/formatters.js"></script>
    <script src="/facture/js/state.js"></script>
    <script src="/facture/js/storage.js"></script>
    <script src="/facture/js/ui.js"></script>
    <script src="/facture/js/app.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
const FIXED_PASSWORD = 'Paul0911';
const KEY_UNLOCK = 'site_unlocked';


const overlay = document.getElementById('pwOverlay');
const siteWrap = document.getElementById('siteWrap');
const pwInput = document.getElementById('pwInput');
const submitBtn = document.getElementById('pwSubmit');
const message = document.getElementById('message');
const rememberCb = document.getElementById('rememberCb');


if (!overlay || !siteWrap || !pwInput || !submitBtn || !message) {
console.error('Erreur: un ou plusieurs √©l√©ments du DOM sont introuvables');
return;
}


function showOverlay() {
overlay.style.display = 'flex';
siteWrap.classList.add('blurred');
pwInput.focus();
}


function hideOverlay() {
overlay.classList.add('fade-out');
siteWrap.classList.remove('blurred');
setTimeout(function() {
overlay.style.display = 'none';
overlay.classList.remove('fade-out');
}, 500);
}


function showMessage(text, color = '#ff5555') {
message.textContent = text;
message.style.color = color;
}


if (localStorage.getItem(KEY_UNLOCK) === '1') {
hideOverlay();
} else {
showOverlay();
}


submitBtn.addEventListener('click', function() {
const val = pwInput.value.trim();
if (!val) {
showMessage('‚ö†Ô∏è Veuillez entrer un mot de passe.');
return;
}
if (val === FIXED_PASSWORD) {
showMessage('‚úÖ Acc√®s autoris√©', '#58a6ff');
if (rememberCb.checked) localStorage.setItem(KEY_UNLOCK, '1');
setTimeout(function() {
hideOverlay();
pwInput.value = '';
}, 300);
} else {
showMessage('‚ùå Mot de passe incorrect.');
pwInput.value = '';
pwInput.focus();
}
});


pwInput.addEventListener('keydown', function(e) {
if (e.key === 'Enter') submitBtn.click();
});
});
</script>

  </body>
</html>
